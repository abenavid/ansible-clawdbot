---
# Linux-specific system tools installation (RedHat family: RHEL, CentOS, Rocky, Alma)

- name: Install essential system tools (RedHat family - dnf/yum)
  ansible.builtin.dnf:
    name:
      # Shells
      - zsh
      # Editors
      - vim
      - nano
      # Version control
      - git
      - git-lfs
      # Network tools
      - curl
      - wget
      - nmap-ncat
      - net-tools
      - bind-utils
      - iputils
      - traceroute
      - tcpdump
      - nmap
      - socat
      - telnet
      # Debugging / monitoring tools
      - strace
      - lsof
      - gdb
      - htop
      - iotop
      - iftop
      - sysstat
      # System utilities
      - tmux
      - tree
      - jq
      - unzip
      - rsync
      - less
      # Build essentials for Homebrew on Linux
      - gcc
      - gcc-c++
      - make
      - file
    state: present
    update_cache: true

- name: Set zsh as default shell for clawdbot user (RedHat family)
  ansible.builtin.user:
    name: "{{ clawdbot_user }}"
    shell: /usr/bin/zsh

- name: Deploy global vim configuration (RedHat family)
  ansible.builtin.template:
    src: vimrc.j2
    dest: /etc/vimrc
    owner: root
    group: root
    mode: '0644'

- name: Configure .bashrc for clawdbot user (RedHat family)
  ansible.builtin.blockinfile:
    path: "{{ clawdbot_home }}/.bashrc"
    marker: "# {mark} ANSIBLE MANAGED BLOCK - Clawdbot config"
    block: |
      # Enable 256 colors
      export TERM=xterm-256color
      export COLORTERM=truecolor

      # Add Homebrew to PATH (Linux)
      eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"

      # Add pnpm to PATH
      export PNPM_HOME="{{ clawdbot_home }}/.local/share/pnpm"
      export PATH="{{ clawdbot_home }}/.local/bin:$PNPM_HOME:$PATH"

      # Color support for common tools
      export CLICOLOR=1
      export LS_COLORS='di=34:ln=35:so=32:pi=33:ex=31:bd=34;46:cd=34;43:su=30;41:sg=30;46:tw=30;42:ow=30;43'

      # Aliases
      alias ls='ls --color=auto'
      alias grep='grep --color=auto'
      alias ll='ls -lah'
    create: true
    owner: "{{ clawdbot_user }}"
    group: "{{ clawdbot_user }}"
    mode: '0644'

- name: Configure .zshrc for clawdbot user (RedHat family)
  ansible.builtin.blockinfile:
    path: "{{ clawdbot_home }}/.zshrc"
    marker: "# {mark} ANSIBLE MANAGED BLOCK - Clawdbot config"
    block: |
      # Enable 256 colors
      export TERM=xterm-256color
      export COLORTERM=truecolor

      # Add Homebrew to PATH (Linux)
      eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"

      # Add pnpm to PATH
      export PNPM_HOME="{{ clawdbot_home }}/.local/share/pnpm"
      export PATH="{{ clawdbot_home }}/.local/bin:$PNPM_HOME:$PATH"

      # Color support for common tools
      export CLICOLOR=1
      export LS_COLORS='di=34:ln=35:so=32:pi=33:ex=31:bd=34;46:cd=34;43:su=30;41:sg=30;46:tw=30;42:ow=30;43'

      # Aliases
      alias ls='ls --color=auto'
      alias grep='grep --color=auto'
      alias ll='ls -lah'
    create: true
    owner: "{{ clawdbot_user }}"
    group: "{{ clawdbot_user }}"
    mode: '0644'

